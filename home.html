<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - TechFix Repairs</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        :root {
            --tf-primary: #0d6efd;
            --tf-dark: #212529;
            --tf-light: #f8f9fa;
        }
        .welcome-banner {
            background: linear-gradient(135deg, var(--tf-primary) 0%, #0056b3 100%);
            color: white;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform .2s ease, box-shadow .2s ease;
            height: 100%;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        .quick-action-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all .2s ease;
            cursor: pointer;
            height: 100%;
        }
        .quick-action-card:hover {
            border-color: var(--tf-primary);
            background: rgba(13, 110, 253, 0.05);
            transform: translateY(-4px);
        }
        .quick-action-card i {
            font-size: 2.5rem;
            color: var(--tf-primary);
            margin-bottom: 1rem;
        }
        .booking-item {
            border-left: 4px solid var(--tf-primary);
            transition: transform .2s ease;
        }
        .booking-item:hover {
            transform: translateX(4px);
        }
        .booking-item.pending { border-left-color: #ffc107; }
        .booking-item.confirmed { border-left-color: #0dcaf0; }
        .booking-item.completed { border-left-color: #198754; }
        .navbar-brand i {
            color: var(--tf-primary);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="home.html">
                <i class="bi bi-gear-wide-connected me-2"></i> TechFix Repairs
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item active"><a class="nav-link active" href="home.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="services.html">Services</a></li>
                    <li class="nav-item d-none" id="nav-my-bookings"><a class="nav-link" href="my-bookings.html">My Bookings</a></li>
                    <li class="nav-item d-none" id="nav-my-devices"><a class="nav-link" href="my-devices.html">My Devices</a></li>
                    <li class="nav-item d-none" id="nav-profile"><a class="nav-link" href="profile.html">Profile</a></li>
                    <li class="nav-item" id="auth-login"><a class="nav-link" href="login.html">Login</a></li>
                    <li class="nav-item" id="auth-register"><a class="nav-link" href="register.html">Register</a></li>
                    <li class="nav-item d-none" id="auth-logout"><a class="nav-link" href="#">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <!-- Welcome Banner -->
        <div class="welcome-banner">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2 class="mb-2">Welcome back, <span id="user-name">Customer</span>!</h2>
                    <p class="mb-0 opacity-75">Manage your device repairs and track your bookings all in one place.</p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <a href="book.html" class="btn btn-light btn-lg">
                        <i class="bi bi-calendar-plus me-2"></i>Book a Repair
                    </a>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon me-3" style="background: linear-gradient(135deg, var(--tf-primary) 0%, #0056b3 100%);">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-1 small">Total Bookings</h6>
                            <h3 class="mb-0" id="stat-bookings">0</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon me-3" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-1 small">Pending</h6>
                            <h3 class="mb-0" id="stat-pending">0</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon me-3" style="background: linear-gradient(135deg, #198754 0%, #146c43 100%);">
                            <i class="bi bi-laptop"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-1 small">My Devices</h6>
                            <h3 class="mb-0" id="stat-devices">0</h3>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon me-3" style="background: linear-gradient(135deg, #0dcaf0 0%, #0aa2c0 100%);">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div>
                            <h6 class="text-muted mb-1 small">Completed</h6>
                            <h3 class="mb-0" id="stat-completed">0</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12 mb-3">
                <h4>Quick Actions</h4>
            </div>
            <div class="col-md-3 mb-3">
                <div class="quick-action-card" onclick="window.location.href='book.html'">
                    <i class="bi bi-calendar-plus"></i>
                    <h5>Book Repair</h5>
                    <p class="text-muted small mb-0">Schedule a new repair appointment</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="quick-action-card" onclick="window.location.href='my-bookings.html'">
                    <i class="bi bi-calendar-check"></i>
                    <h5>My Bookings</h5>
                    <p class="text-muted small mb-0">View all your repair bookings</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="quick-action-card" onclick="window.location.href='my-devices.html'">
                    <i class="bi bi-laptop"></i>
                    <h5>My Devices</h5>
                    <p class="text-muted small mb-0">Manage your registered devices</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="quick-action-card" onclick="window.location.href='services.html'">
                    <i class="bi bi-tools"></i>
                    <h5>Services</h5>
                    <p class="text-muted small mb-0">Browse available repair services</p>
                </div>
            </div>
        </div>

        <!-- Recent Bookings -->
        <div class="row">
            <div class="col-md-8 mb-4">
                <div class="card">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Recent Bookings</h5>
                        <a href="my-bookings.html" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="card-body">
                        <div id="recent-bookings">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div id="no-bookings" class="text-center py-4 d-none">
                            <i class="bi bi-calendar-x" style="font-size: 3rem; color: #ccc;"></i>
                            <p class="text-muted mt-3">No bookings yet</p>
                            <a href="book.html" class="btn btn-primary btn-sm">Book Your First Repair</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Bookings -->
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Upcoming</h5>
                    </div>
                    <div class="card-body">
                        <div id="upcoming-bookings">
                            <div class="text-center py-4">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                        <div id="no-upcoming" class="text-center py-4 d-none">
                            <i class="bi bi-calendar-check" style="font-size: 2rem; color: #ccc;"></i>
                            <p class="text-muted small mt-2">No upcoming bookings</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-auto">
        <div class="container">
            <p>&copy; 2025 TechFix Repairs. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
    <script>
        $(document).ready(function() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Set user name
            $('#user-name').text(user.full_name || user.username);

            // Load dashboard data
            loadDashboard();
        });

        function loadDashboard() {
            // Load bookings stats and recent bookings
            axios.get(`${API_URL}/my-bookings`)
                .then(response => {
                    const data = response.data;
                    const bookings = data.repairs || [];

                    // Update statistics
                    $('#stat-bookings').text(data.total || 0);
                    $('#stat-pending').text(data.pending || 0);
                    $('#stat-completed').text(data.completed || 0);

                    // Display recent bookings (last 5)
                    const recentBookings = bookings.slice(0, 5);
                    displayRecentBookings(recentBookings);

                    // Display upcoming bookings
                    const upcoming = bookings.filter(b => {
                        const bookingDate = new Date(b.date);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        return bookingDate >= today && b.status !== 'completed' && b.status !== 'cancelled';
                    }).slice(0, 3);
                    displayUpcomingBookings(upcoming);
                })
                .catch(error => {
                    console.error('Error loading bookings:', error);
                });

            // Load devices count
            axios.get(`${API_URL}/my-devices`)
                .then(response => {
                    $('#stat-devices').text(response.data.total || 0);
                })
                .catch(error => {
                    console.error('Error loading devices:', error);
                });
        }

        function displayRecentBookings(bookings) {
            const container = $('#recent-bookings');
            
            if (bookings.length === 0) {
                $('#no-bookings').removeClass('d-none');
                container.addClass('d-none');
                return;
            }

            container.removeClass('d-none');
            $('#no-bookings').addClass('d-none');
            container.empty();

            bookings.forEach(booking => {
                const device = booking.device || {};
                const deviceName = device.make && device.model ? `${device.make} ${device.model}` : 'Unknown Device';
                const statusColor = getStatusColor(booking.status);
                const statusLabel = booking.status.charAt(0).toUpperCase() + booking.status.slice(1);
                const bookingDate = new Date(booking.date).toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });

                container.append(`
                    <div class="booking-item ${booking.status} mb-3 p-3 rounded" style="background: #f8f9fa;">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">${deviceName}</h6>
                                <p class="text-muted small mb-1">
                                    <i class="bi bi-calendar-event me-1"></i>${bookingDate} 
                                    <i class="bi bi-clock ms-2 me-1"></i>${booking.time_slot}
                                </p>
                                <span class="badge bg-${statusColor}">${statusLabel}</span>
                            </div>
                            <a href="my-bookings.html" class="btn btn-sm btn-outline-primary">View</a>
                        </div>
                    </div>
                `);
            });
        }

        function displayUpcomingBookings(bookings) {
            const container = $('#upcoming-bookings');
            
            if (bookings.length === 0) {
                $('#no-upcoming').removeClass('d-none');
                container.addClass('d-none');
                return;
            }

            container.removeClass('d-none');
            $('#no-upcoming').addClass('d-none');
            container.empty();

            bookings.forEach(booking => {
                const device = booking.device || {};
                const deviceName = device.make && device.model ? `${device.make} ${device.model}` : 'Unknown Device';
                const bookingDate = new Date(booking.date).toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric'
                });

                container.append(`
                    <div class="mb-3 pb-3 border-bottom">
                        <h6 class="mb-1 small">${deviceName}</h6>
                        <p class="text-muted small mb-0">
                            <i class="bi bi-calendar me-1"></i>${bookingDate}<br>
                            <i class="bi bi-clock me-1"></i>${booking.time_slot}
                        </p>
                    </div>
                `);
            });
        }

        function getStatusColor(status) {
            switch(status) {
                case 'pending': return 'warning';
                case 'confirmed': return 'info';
                case 'completed': return 'success';
                case 'cancelled': return 'danger';
                default: return 'secondary';
            }
        }
    </script>
</body>
</html>

